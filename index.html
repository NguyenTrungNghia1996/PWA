<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="manifest" id="my-manifest-placeholder">
</head>

<body>
<h1>PWA APP TEST</h1>
<button type="button" id="btnAdd">Click Me!</button>
</body>
<script>
    let myDynamicManifest = {
        "$schema": "http://json.schemastore.org/web-manifest",
        "short_name": "PWA",
        "name": "PWA APP TEST",
        "description": "description",
        //"scope": "https://pwaapptes.herokuapp.com/",
        "icons": [
            {
                "src": "https://pwaapptes.herokuapp.com/icon/manifest-icon-192.png",
                "sizes": "192x192",
                "type": "image/png",
                "purpose": "maskable any"
            },
            {
                "src": "https://pwaapptes.herokuapp.com/icon/manifest-icon-512.png",
                "sizes": "512x512",
                "type": "image/png",
                "purpose": "maskable any"
            }
        ],
        "background_color": "#c15252",
        "theme_color": "#556f91",
        "start_url": "https://pwaapptes.herokuapp.com/index.html",
        "display": "standalone",
        "orientation": "any"
    }
    const stringManifest = JSON.stringify(myDynamicManifest);
    const blob = new Blob([stringManifest], {type: 'application/json'});
    const manifestURL = URL.createObjectURL(blob);
    document.querySelector('#my-manifest-placeholder').setAttribute('href', manifestURL);
    
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/service-worker.js');
    }
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        btnAdd.style.display = 'block';
    });
    btnAdd.addEventListener('click', (e) => {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === 'accepted') {
                console.log('usserkfs');
            }
            deferredPrompt = null;
        });
    });
    window.addEventListener('appinstalled', (evt) => {
        app.logEvent('a2hs', 'installed');
    });
    //document.querySelector('#my-manifest-placeholder').setAttribute('href', '/my-dynamic-manifest-url.json');

</script>
</html>
